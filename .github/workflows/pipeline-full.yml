name: ITB Trading Pipeline - Full

on:
  workflow_dispatch:
    inputs:
      config_path:
        description: "Config file (e.g., configs/btcusdt_5m_aggressive.jsonc)"
        required: true
        default: "configs/btcusdt_1m_dev.jsonc"
      image_tag:
        description: "Docker image tag (e.g., amd64-1764313462 or latest)"
        required: true
        default: "latest"

jobs:
  merge_features:
    name: Merge + Features
    uses: ./.github/workflows/step-merge-features.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}

  labels:
    name: Generate Labels
    needs: merge_features
    uses: ./.github/workflows/step-labels.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}

  train:
    name: Train Models
    needs: labels
    uses: ./.github/workflows/step-train.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}

  predict_signals:
    name: Predict + Signals
    needs: train
    uses: ./.github/workflows/step-predict-signals.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}
