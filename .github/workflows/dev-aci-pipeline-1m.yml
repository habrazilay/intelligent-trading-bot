name: Run full BTCUSDT 1m dev pipeline on Azure ACI (via child workflows)

on:
  workflow_dispatch:
    inputs:
      config_path:
        description: "Path to JSONC config file"
        required: true
        default: "configs/btcusdt_1m_dev.jsonc"
      image_tag:
        description: "Image tag (just the tag, e.g. amd64-1764313462)"
        required: true
        default: "amd64-1764313462"

jobs:
  merge_features:
    uses: ./.github/workflows/merge-only-aci.yml
    secrets: inherit              
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}

  labels:
    needs: merge_features
    uses: ./.github/workflows/labels_new-olny-aci.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}

  train:
    needs: labels
    uses: ./.github/workflows/train-only-aci.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}

  predict_signals:
    needs: train
    uses: ./.github/workflows/predict-signals-only-aci.yml
    secrets: inherit
    with:
      config_path: ${{ github.event.inputs.config_path }}
      image_tag:   ${{ github.event.inputs.image_tag }}
